<div class="container">
  <div class="flex-between mb-20">
    <h1 class="page-title">Customers</h1>
    <button class="btn btn-primary" (click)="openAddModal()">+ Add Customer</button>
  </div>

  <div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>
  <div *ngIf="error" class="alert alert-error">{{ error }}</div>

  <div class="card">
    <div class="search-box">
      <input
        type="text"
        class="form-control"
        placeholder="Search by name, phone, or email..."
        [(ngModel)]="searchQuery"
        (input)="searchCustomers()"
      />
    </div>

    <div *ngIf="loading" class="text-center">
      <p>Loading customers...</p>
    </div>

    <table *ngIf="!loading && paginatedCustomers.length > 0">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Phone</th>
          <th>Email</th>
          <th>City</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let customer of paginatedCustomers">
          <td>{{ customer.id }}</td>
          <td>{{ customer.name }}</td>
          <td>{{ customer.phone }}</td>
          <td>{{ customer.email || 'N/A' }}</td>
          <td>{{ customer.city || 'N/A' }}</td>
          <td>
            <div class="action-buttons">
              <button class="btn btn-sm btn-secondary" (click)="openEditModal(customer)">Edit</button>
              <button class="btn btn-sm btn-warning" (click)="viewMeasurements(customer.id)">Measurements</button>
              <button class="btn btn-sm btn-danger" (click)="deleteCustomer(customer.id)">Delete</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!loading && filteredCustomers.length > 0" class="pagination">
      <button (click)="previousPage()" [disabled]="currentPage === 1">← Previous</button>
      <span class="page-info">Page {{ currentPage }} of {{ totalPages }}</span>
      <button (click)="nextPage()" [disabled]="currentPage === totalPages">Next →</button>
    </div>

    <p *ngIf="!loading && filteredCustomers.length === 0" class="text-center">No customers found</p>
  </div>
</div>

<!-- Customer Modal -->
<div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ isEditMode ? 'Edit Customer' : 'Add Customer' }}</h2>
      <button class="close-btn" (click)="closeModal()">&times;</button>
    </div>

    <form (ngSubmit)="saveCustomer()">
      <div class="form-group">
        <label>Name *</label>
        <input type="text" class="form-control" [(ngModel)]="customerForm.name" name="name" required />
      </div>

      <div class="form-group">
        <label>Phone *</label>
        <input type="tel" class="form-control" [(ngModel)]="customerForm.phone" name="phone" required />
      </div>

      <div class="form-group">
        <label>Email</label>
        <input type="email" class="form-control" [(ngModel)]="customerForm.email" name="email" />
      </div>

      <div class="form-group">
        <label>Address</label>
        <textarea class="form-control" [(ngModel)]="customerForm.address" name="address" rows="3"></textarea>
      </div>

      <div class="form-group">
        <label>City</label>
        <input type="text" class="form-control" [(ngModel)]="customerForm.city" name="city" />
      </div>

      <div class="flex flex-gap mt-20">
        <button type="submit" class="btn btn-primary">{{ isEditMode ? 'Update' : 'Create' }}</button>
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
      </div>
    </form>
  </div>
</div>
